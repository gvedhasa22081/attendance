<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Smart Attendance System</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    body {
      margin: 0;
      font-family: system-ui, sans-serif;
      background: linear-gradient(135deg, #020617, #0f172a, #1e3a8a);
      color: #e5e7eb;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 14px;
    }

    .app {
      width: 100%;
      max-width: 420px;
      background: rgba(15,23,42,0.95);
      border-radius: 22px;
      padding: 16px;
      box-shadow: 0 0 40px rgba(0,0,0,0.8);
    }

    .header h1 {
      font-size: 18px;
      letter-spacing: 0.12em;
      margin: 0;
    }

    .header p {
      font-size: 12px;
      opacity: 0.85;
      margin-top: 6px;
    }

    .status {
      margin-top: 10px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      border-radius: 999px;
      border: 1px solid #64748b;
      font-size: 11px;
    }

    .dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: red;
    }

    .dot.on {
      background: #22c55e;
    }

    .card {
      margin-top: 14px;
      background: rgba(2,6,23,0.9);
      border-radius: 16px;
      padding: 12px;
      border: 1px solid #334155;
    }

    .card h2 {
      font-size: 14px;
      margin: 0;
    }

    .card p {
      font-size: 11px;
      opacity: 0.8;
      margin-top: 4px;
    }

    .camera {
      margin-top: 10px;
      border-radius: 12px;
      overflow: hidden;
      aspect-ratio: 16/9;
      background: black;
    }

    video {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .buttons {
      margin-top: 10px;
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    button {
      flex: 1;
      border: none;
      border-radius: 999px;
      padding: 8px;
      font-size: 13px;
      cursor: pointer;
    }

    .start {
      background: #22c55e;
      color: #022c22;
    }

    .stop {
      background: #020617;
      color: white;
      border: 1px solid #475569;
    }

    .reset {
      background: #dc2626;
      color: white;
    }

    .lists {
      display: flex;
      gap: 8px;
      margin-top: 10px;
    }

    .list {
      flex: 1;
      background: rgba(15,23,42,0.9);
      border-radius: 12px;
      padding: 8px;
      border: 1px solid #334155;
      max-height: 160px;
      overflow-y: auto;
      font-size: 12px;
    }

    .chip {
      padding: 6px;
      border-radius: 999px;
      border: 1px solid #64748b;
      margin-bottom: 6px;
      text-align: center;
    }

    .chip.present {
      border-color: #22c55e;
      background: rgba(34,197,94,0.15);
    }

    .footer {
      margin-top: 10px;
      font-size: 11px;
      text-align: center;
      opacity: 0.85;
    }

    #popup {
      position: fixed;
      top: 20px;
      right: 20px;
      background: #16a34a;
      color: white;
      padding: 12px 16px;
      border-radius: 14px;
      display: none;
      box-shadow: 0 0 20px rgba(34,197,94,0.9);
      z-index: 9999;
    }
  </style>
</head>

<body>

<div id="popup">✅ Attendance taken successfully</div>

<div class="app">
  <div class="header">
    <h1>SMART ATTENDANCE SYSTEM</h1>
    <p>Automated attendance monitoring using live camera feed.</p>
    <div class="status">
      <span id="dot" class="dot"></span>
      <span id="statusText">Idle · Camera off</span>
    </div>
  </div>

  <div class="card">
    <h2>Live Camera & Attendance Detection</h2>
    <p>Enable camera to begin attendance monitoring.</p>

    <div class="camera">
      <video id="video" autoplay muted playsinline></video>
    </div>

    <div class="buttons">
      <button class="start" id="startBtn">▶ Start Camera</button>
      <button class="stop" id="stopBtn" disabled>■ Stop Camera</button>
      <button class="reset" id="resetBtn">↺ Reset</button>
    </div>
  </div>

  <div class="card">
    <h2>Attendance Dashboard</h2>

    <div class="lists">
      <div class="list" id="presentList"><b>Present</b></div>
      <div class="list" id="pendingList"><b>Pending</b></div>
    </div>

    <div class="footer">
      Developed by <strong>Keerthana K</strong>
    </div>
  </div>
</div>

<script>
  const STUDENTS = [
    "Keerthana","Hari Chandana","Vedha Sai G","Ajith Kumar",
    "Shiva Narayana","Rinithasai K","Teja","Hemanth",
    "Likitha","Sai Charan","Navya","Pranav"
  ];

  const present = new Set();
  let stream = null;
  let timer = null;

  const video = document.getElementById("video");
  const dot = document.getElementById("dot");
  const statusText = document.getElementById("statusText");
  const presentList = document.getElementById("presentList");
  const pendingList = document.getElementById("pendingList");

  function updateLists() {
    presentList.innerHTML = "<b>Present</b>";
    pendingList.innerHTML = "<b>Pending</b>";

    STUDENTS.forEach(name => {
      const div = document.createElement("div");
      div.className = "chip " + (present.has(name) ? "present" : "");
      div.textContent = name;
      (present.has(name) ? presentList : pendingList).appendChild(div);
    });
  }

  function showPopup() {
    const p = document.getElementById("popup");
    p.style.display = "block";
    setTimeout(() => p.style.display = "none", 2500);
  }

  function playBeep() {
    const ctx = new (window.AudioContext || window.webkitAudioContext)();
    const osc = ctx.createOscillator();
    osc.frequency.value = 880;
    osc.connect(ctx.destination);
    osc.start();
    osc.stop(ctx.currentTime + 0.2);
  }

  function speak() {
    if (!("speechSynthesis" in window)) return;
    const msg = new SpeechSynthesisUtterance("Attendance taken successfully");
    window.speechSynthesis.cancel();
    window.speechSynthesis.speak(msg);
  }

  async function startCamera() {
    stream = await navigator.mediaDevices.getUserMedia({ video: true });
    video.srcObject = stream;
    dot.classList.add("on");
    statusText.textContent = "Live · Attendance monitoring active";

    timer = setInterval(() => {
      const pending = STUDENTS.filter(s => !present.has(s));
      if (pending.length === 0) return;

      const selected = pending[Math.floor(Math.random() * pending.length)];
      present.add(selected);
      updateLists();
      showPopup();
      playBeep();
      speak();
    }, 20000); // 20 seconds gap

    startBtn.disabled = true;
    stopBtn.disabled = false;
  }

  function stopCamera() {
    stream.getTracks().forEach(t => t.stop());
    clearInterval(timer);
    dot.classList.remove("on");
    statusText.textContent = "Idle · Camera off";
    startBtn.disabled = false;
    stopBtn.disabled = true;
  }

  startBtn.onclick = startCamera;
  stopBtn.onclick = stopCamera;
  resetBtn.onclick = () => {
    present.clear();
    updateLists();
  };

  updateLists();
</script>

</body>
</html>
